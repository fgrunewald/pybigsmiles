Nesting doesn't work properly
- do we need to generate the branch first then attach
